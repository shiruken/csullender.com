<!doctype html><html lang=en><head><title>Migrating Hugo deployment to GitHub Actions from TravisCI · Colin Sullender
</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="Colin Sullender"><meta name=description content="With the recent shutdown of travis-ci.org and the announcement of a new pricing model for TravisCI with limited free usage, I made the decision to migrate the CI/CD for this website to GitHub Actions. As I mentioned when I first transitioned to using Hugo, I&rsquo;m still hosting this website on a paid server to retain a few dynamic pages that would not work properly on a Netlify deployment. The following are the steps that I took to migrate between services."><meta name=keywords content="personal,blog,biomedical,engineer,optics,researcher"><meta name=twitter:card content="summary"><meta name=twitter:title content="Migrating Hugo deployment to GitHub Actions from TravisCI"><meta name=twitter:description content="With the recent shutdown of travis-ci.org and the announcement of a new pricing model for TravisCI with limited free usage, I made the decision to migrate the CI/CD for this website to GitHub Actions. As I mentioned when I first transitioned to using Hugo, I&rsquo;m still hosting this website on a paid server to retain a few dynamic pages that would not work properly on a Netlify deployment. The following are the steps that I took to migrate between services."><meta property="og:url" content="https://csullender.com/posts/migrating-to-github-actions/"><meta property="og:site_name" content="Colin Sullender"><meta property="og:title" content="Migrating Hugo deployment to GitHub Actions from TravisCI"><meta property="og:description" content="With the recent shutdown of travis-ci.org and the announcement of a new pricing model for TravisCI with limited free usage, I made the decision to migrate the CI/CD for this website to GitHub Actions. As I mentioned when I first transitioned to using Hugo, I’m still hosting this website on a paid server to retain a few dynamic pages that would not work properly on a Netlify deployment. The following are the steps that I took to migrate between services."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-02-22T14:12:14-05:00"><meta property="article:modified_time" content="2021-02-22T18:58:02-05:00"><meta property="article:tag" content="Web"><meta property="article:tag" content="Software"><meta property="article:tag" content="Tips & Tricks"><link rel=canonical href=https://csullender.com/posts/migrating-to-github-actions/><link rel=preload href=/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.38c4552ac40f9ae3408bad40358f654ebd8804412fe74ed56f2d6c8a7af82dd3.css integrity="sha256-OMRVKsQPmuNAi61ANY9lTr2IBEEv507Vby1sinr4LdM=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/custom.min.2db64aa52851a2640748a1b94e114ce4baba720f28653990be14c8bec384d317.css integrity="sha256-LbZKpShRomQHSKG5ThFM5Lq6cg8oZTmQvhTIvsOE0xc=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/academicons.min.min.f6abb61f6b9b2e784eba22dfb93cd399ce30ee01825791830a2737d6bfcd2be9.css integrity="sha256-9qu2H2ubLnhOuiLfuTzTmc4w7gGCV5GDCic31r/NK+k=" crossorigin=anonymous media=screen><link rel=icon type=image/svg+xml href=/images/favicon.svg sizes=any><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=https://csullender.com/>Colin Sullender
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/about>About</a></li><li class=navigation-item><a class=navigation-link href=/posts>Blog</a></li><li class=navigation-item><a class=navigation-link href=/research>Research</a></li><li class=navigation-item><a class=navigation-link href=/coding>Coding</a></li><li class=navigation-item><a class=navigation-link href=/websites>Websites</a></li><li class=navigation-item><a class=navigation-link href=https://sciencegifs.csullender.com/>Science GIFs</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://csullender.com/posts/migrating-to-github-actions/>Migrating Hugo deployment to GitHub Actions from TravisCI</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa-solid fa-calendar" aria-hidden=true></i>
<time datetime=2021-02-22T14:12:14-05:00>February 22, 2021
</time></span><span class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>
5-minute read</span></div><div class=tags><i class="fa-solid fa-tag" aria-hidden=true></i>
<span class=tag><a href=/tags/web/>Web</a>
</span><span class=separator>•</span>
<span class=tag><a href=/tags/software/>Software</a>
</span><span class=separator>•</span>
<span class=tag><a href=/tags/tips--tricks/>Tips & Tricks</a></span></div></div></header><div class=post-content><p>With the <a href=https://mailchi.mp/3d439eeb1098/travis-ciorg-is-moving-to-travis-cicom class=external-link target=_blank rel=noopener>recent shutdown of travis-ci.org</a> and the <a href=https://blog.travis-ci.com/2020-11-02-travis-ci-new-billing class=external-link target=_blank rel=noopener>announcement of a new pricing model</a> for TravisCI with limited free usage, I made the decision to migrate the CI/CD for this website to <a href=https://github.com/features/actions class=external-link target=_blank rel=noopener>GitHub Actions</a>. As I mentioned <a href=/posts/goodbye-wordpress-hello-hugo/>when I first transitioned to using Hugo</a>, I&rsquo;m still hosting this website on a paid server to retain a few dynamic pages that would not work properly on a <a href=https://gohugo.io/hosting-and-deployment/hosting-on-netlify/ class=external-link target=_blank rel=noopener>Netlify deployment</a>. The following are the steps that I took to migrate between services.</p><p><img src=travis-github.png alt="Migrating from TravisCI to GitHub Actions"></p><h1 id=remove-travisci-from-your-project-and-github>Remove TravisCI from your project and GitHub
<a class=heading-link href=#remove-travisci-from-your-project-and-github><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>Delete the <code>.travis.yml</code> configuration file and any other TravisCI-related files in your repository (e.g. encrypted credentials). If you included a build status badge in the README, be sure to remove that as well.</p><p>Since this was my only project using TravisCI, I also revoked the <a href=https://github.com/settings/applications class=external-link target=_blank rel=noopener>application&rsquo;s permissions on GitHub</a>.</p><p><img src=revoke.png alt="Revoked TravisCI access to GitHub"></p><h1 id=add-a-github-action-workflow-to-your-project>Add a GitHub Action workflow to your project
<a class=heading-link href=#add-a-github-action-workflow-to-your-project><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>The next step is to create a new GitHub Action workflow that will build your Hugo site and deploy it to the server of your choice using <a href=https://linux.die.net/man/1/rsync class=external-link target=_blank rel=noopener>rsync</a>. Navigate to the Actions tab in your GitHub repository and select the &ldquo;Skip this and set up a workflow yourself&rdquo; option to directly access the workflow editor. Workflows <a href=https://docs.github.com/en/actions/reference/workflow-syntax-for-github-actions class=external-link target=_blank rel=noopener>use YAML syntax</a> and are saved within the <code>.github/workflows/</code> directory in your repository.</p><p><strong>The current workflow for building and deploying this website can be seen <a href=https://github.com/shiruken/csullender.com/blob/master/.github/workflows/build.yml class=external-link target=_blank rel=noopener><strong>here</strong></a> if you want to skip the explanation below.</strong></p><p>The first section of the file defines the name and the GitHub events that trigger the workflow. We want the workflow to be triggered when code is pushed to any branch in the repository (<code>push</code>) or manually triggered by the owner (<code>workflow_dispatch</code>).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ff79c6>name</span>: Build Site
</span></span><span style=display:flex><span><span style=color:#ff79c6>on</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>push</span>: 
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>workflow_dispatch</span>: </span></span></code></pre></div><p>The next section defines the <a href=https://docs.github.com/en/actions/reference/workflow-syntax-for-github-actions#jobs class=external-link target=_blank rel=noopener>job(s)</a> that constitute the workflow. In this case, there is only a single job called <code>build</code> that runs on the latest version of Ubuntu. Jobs are composed of individual <a href=https://docs.github.com/en/actions/reference/workflow-syntax-for-github-actions#jobsjob_idsteps class=external-link target=_blank rel=noopener>steps</a> that are executed sequentially. These steps are frequently predefined GitHub Actions available via the <a href="https://github.com/marketplace?type=actions" class=external-link target=_blank rel=noopener>Marketplace</a>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ff79c6>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>build</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>name</span>: Build Hugo Site
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>runs-on</span>: ubuntu-latest
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>steps</span>: </span></span></code></pre></div><p>The first step uses the <a href=https://github.com/marketplace/actions/checkout class=external-link target=_blank rel=noopener><code>checkout</code></a> action to check-out the current repository into our workspace. Since our Hugo theme (<a href=https://github.com/luizdepra/hugo-coder class=external-link target=_blank rel=noopener>hugo-coder</a>) is included in the project as a submodule, we need to include the <code>submodules: true</code> input parameter to properly check it out.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#ff79c6>name</span>: Checkout Repository
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>uses</span>: actions/checkout@v2
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>with</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>submodules</span>: <span style=color:#ff79c6>true</span></span></span></code></pre></div><p>The next step uses the <a href=https://github.com/marketplace/actions/hugo-setup class=external-link target=_blank rel=noopener><code>actions-hugo</code></a> action to install Hugo to our workspace. The input parameters control the specific version of Hugo to install. The <a href=https://github.com/luizdepra/hugo-coder class=external-link target=_blank rel=noopener>hugo-coder theme</a> requires the extended version of Hugo.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#ff79c6>name</span>: Setup Hugo
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>uses</span>: peaceiris/actions-hugo@v2
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>with</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>hugo-version</span>: <span style=color:#f1fa8c>&#39;latest&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>extended</span>: <span style=color:#ff79c6>true</span></span></span></code></pre></div><p>With Hugo installed, we can now build our site using the <a href=https://docs.github.com/en/actions/reference/workflow-syntax-for-github-actions#jobsjob_idstepsrun class=external-link target=_blank rel=noopener><code>run</code> command</a> to call the <code>hugo</code> program via the command line. This will output the compiled static site into the <code>public/</code> directory.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#ff79c6>name</span>: Build
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>run</span>: hugo</span></span></code></pre></div><p>We&rsquo;re now ready to deploy our freshly built site to the remote server. However, we only want to deploy if we&rsquo;re on the primary branch, so the final step checks for this condition before proceeding. If we&rsquo;re on a non-primary branch, then the workflow will end here.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#ff79c6>name</span>: Deploy
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>if</span>: github.ref == &#39;refs/heads/master&#39;</span></span></code></pre></div><p>In order to deploy to the remote server using rsync, we need to take advantage of encrypted <a href=https://docs.github.com/en/actions/reference/encrypted-secrets class=external-link target=_blank rel=noopener>Repository Secrets</a> to safely store our credentials. You can define these secrets under the settings for your GitHub repository. I opted to use an <a href=https://docs.github.com/en/github/authenticating-to-github/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent#generating-a-new-ssh-key class=external-link target=_blank rel=noopener>SSH key pair</a> to authenticate with the remote server (storing the private key under <code>DEPLOY_KEY</code> and adding the public key to <code>.ssh/authorized_keys</code> on the remote) but a password could also be stored this way. I also defined several other additional secrets to mask the username, hostname, and destination on the remote host. Secrets can be accessed in the workflow file using the <code>{{secrets.SECRETNAME}}</code> syntax. <em>Note: GitHub automatically obfuscates any secrets that are accidentally exposed in the logs via command line outputs.</em></p><p><img src=secrets.png alt="Encrypted Repository Secrets"></p><p>We again use the <code>run</code> command to dump the private key to a file in the workspace, adjust the permissions on the key file, and then use <code>rsync</code> to sync the contents of <code>public/</code> to the remote destination. If all goes well, then your updated site should now be live on your server.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ff79c6>env</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>DEPLOY_KEY</span>: ${{secrets.DEPLOY_KEY}}
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>DEST</span>: ${{secrets.DEPLOY_USER}}@${{secrets.DEPLOY_HOST}}:${{secrets.DEPLOY_DIRECTORY}}
</span></span><span style=display:flex><span><span style=color:#ff79c6>run</span>: |<span style=color:#f1fa8c>
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>  echo &#34;$DEPLOY_KEY&#34; &gt; deploy_key
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>  chmod 600 ./deploy_key
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>  rsync -e &#39;ssh -i ./deploy_key -o StrictHostKeyChecking=no -o LogLevel=ERROR&#39; -r --quiet --delete-after public/* $DEST</span>  </span></span></code></pre></div><h1 id=test-your-new-github-action-workflow>Test your new GitHub Action workflow
<a class=heading-link href=#test-your-new-github-action-workflow><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>Since we enabled manual triggering of the workflow, we can now easily test it. Navigate to the Actions tab in your repository and select the workflow from the list on the left. Click the &ldquo;Run workflow&rdquo; dropdown, select a branch, and then click the green &ldquo;Run workflow&rdquo; button. Your workflow should now be manually executing.</p><p><img src=running.png alt="Running GitHub Actions Workflow"></p><p>If you click through, you can see additional details about the run including the outputs from each stage of the workflow. If you ran the workflow on any branch but the primary one, then the &ldquo;Deploy&rdquo; step should have been skipped.</p><p><img src=output.png alt="GitHub Actions Run Summary"></p><p>You should now have a fully functional CI/CD setup using GitHub Actions to replace the shuttered Open Source TravisCI service! Hopefully GitHub (more likely Microsoft) doesn&rsquo;t start changing the free offerings on their platform anytime soon. Don&rsquo;t forget to re-add the status badge back to your README file!</p><p><img src="https://github.com/shiruken/csullender.com/workflows/Build%20Site/badge.svg?branch=master" alt="Build Site"></p></div><footer><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//csullender.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}(),document.addEventListener("themeChanged",function(){document.readyState=="complete"&&DISQUS.reset({reload:!0,config:disqus_config})})</script></footer></article></section></div><footer class=footer><section class=container>©
2024
Colin Sullender
·
Powered by <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.
[<a href=https://github.com/shiruken/csullender.com/commit/86249c0c54e44524abb387d44cb8b3ce3475bc39 target=_blank rel=noopener>86249c0</a>]</section></footer></main><script src=/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script><script async defer data-domain=csullender.com,/csullender.com src=https://p.csullender.com/js/script.file-downloads.outbound-links.js></script><script>var _paq=window._paq=window._paq||[];_paq.push(["setCookieDomain","*.csullender.com"]),_paq.push(["setDomains",["*.csullender.com"]]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){e="https://m.csullender.com/",_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","1"]);var e,n=document,t=n.createElement("script"),s=n.getElementsByTagName("script")[0];t.async=!0,t.src=e+"matomo.js",s.parentNode.insertBefore(t,s)}()</script><noscript><p><img src="https://m.csullender.com/matomo.php?idsite=1&amp;rec=1" style=border:0 alt></p></noscript><script async defer data-website-id=d6527871-ec0b-4ff7-a839-3601a22d4549 src=https://u.csullender.com/u.js data-domain=csullender.com></script></body></html>