<!doctype html><html lang=en><head><title>Migrating Hugo deployment to GitHub Actions from TravisCI · Colin Sullender</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="Colin Sullender"><meta name=description content="With the recent shutdown of travis-ci.org and the announcement of a new pricing model for TravisCI with limited free usage, I made the decision to migrate the CI/CD for this website to GitHub Actions. As I mentioned when I first transitioned to using Hugo, I&rsquo;m still hosting this website on a paid server to retain a few dynamic pages that would not work properly on a Netlify deployment. The following are the steps that I took to migrate between services."><meta name=keywords content="personal,blog,biomedical,engineer,optics,researcher"><meta name=twitter:card content="summary"><meta name=twitter:title content="Migrating Hugo deployment to GitHub Actions from TravisCI"><meta name=twitter:description content="With the recent shutdown of travis-ci.org and the announcement of a new pricing model for TravisCI with limited free usage, I made the decision to migrate the CI/CD for this website to GitHub Actions. As I mentioned when I first transitioned to using Hugo, I&rsquo;m still hosting this website on a paid server to retain a few dynamic pages that would not work properly on a Netlify deployment. The following are the steps that I took to migrate between services."><meta property="og:title" content="Migrating Hugo deployment to GitHub Actions from TravisCI"><meta property="og:description" content="With the recent shutdown of travis-ci.org and the announcement of a new pricing model for TravisCI with limited free usage, I made the decision to migrate the CI/CD for this website to GitHub Actions. As I mentioned when I first transitioned to using Hugo, I&rsquo;m still hosting this website on a paid server to retain a few dynamic pages that would not work properly on a Netlify deployment. The following are the steps that I took to migrate between services."><meta property="og:type" content="article"><meta property="og:url" content="https://csullender.com/posts/migrating-to-github-actions/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-02-22T14:12:14-05:00"><meta property="article:modified_time" content="2021-02-22T18:58:02-05:00"><link rel=canonical href=https://csullender.com/posts/migrating-to-github-actions/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.c4d7e93a158eda5a65b3df343745d2092a0a1e2170feeec909b8a89443903c6a.css integrity="sha256-xNfpOhWO2lpls980N0XSCSoKHiFw/u7JCbiolEOQPGo=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/custom.min.2db64aa52851a2640748a1b94e114ce4baba720f28653990be14c8bec384d317.css integrity="sha256-LbZKpShRomQHSKG5ThFM5Lq6cg8oZTmQvhTIvsOE0xc=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/academicons.min.min.07f5b6f18720a032cfb2eff6c582b39b2d7a288aeb4f7d65f3cb07a2bec77f0c.css integrity="sha256-B/W28YcgoDLPsu/2xYKzmy16KIrrT31l88sHor7Hfww=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5><meta name=generator content="Hugo 0.104.3"></head><body class="preload-transitions colorscheme-light"><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>Colin Sullender</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/about>About</a></li><li class=navigation-item><a class=navigation-link href=/posts>Blog</a></li><li class=navigation-item><a class=navigation-link href=/research>Research</a></li><li class=navigation-item><a class=navigation-link href=/coding>Coding</a></li><li class=navigation-item><a class=navigation-link href=/websites>Websites</a></li><li class=navigation-item><a class=navigation-link href=https://sciencegifs.csullender.com/>Science GIFs</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://csullender.com/posts/migrating-to-github-actions/>Migrating Hugo deployment to GitHub Actions from TravisCI</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2021-02-22T14:12:14-05:00>February 22, 2021</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
5-minute read</span></div><div class=tags><i class="fa fa-tag" aria-hidden=true></i>
<span class=tag><a href=/tags/web/>Web</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/software/>Software</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/tips-tricks/>Tips & Tricks</a></span></div></div></header><div><p>With the <a href=https://mailchi.mp/3d439eeb1098/travis-ciorg-is-moving-to-travis-cicom>recent shutdown of travis-ci.org</a> and the <a href=https://blog.travis-ci.com/2020-11-02-travis-ci-new-billing>announcement of a new pricing model</a> for TravisCI with limited free usage, I made the decision to migrate the CI/CD for this website to <a href=https://github.com/features/actions>GitHub Actions</a>. As I mentioned <a href=/posts/goodbye-wordpress-hello-hugo/>when I first transitioned to using Hugo</a>, I&rsquo;m still hosting this website on a paid server to retain a few dynamic pages that would not work properly on a <a href=https://gohugo.io/hosting-and-deployment/hosting-on-netlify/>Netlify deployment</a>. The following are the steps that I took to migrate between services.</p><p><img src=travis-github.png alt="Migrating from TravisCI to GitHub Actions"></p><h1 id=remove-travisci-from-your-project-and-github>Remove TravisCI from your project and GitHub
<a class=heading-link href=#remove-travisci-from-your-project-and-github><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>Delete the <code>.travis.yml</code> configuration file and any other TravisCI-related files in your repository (e.g. encrypted credentials). If you included a build status badge in the README, be sure to remove that as well.</p><p>Since this was my only project using TravisCI, I also revoked the <a href=https://github.com/settings/applications>application&rsquo;s permissions on GitHub</a>.</p><p><img src=revoke.png alt="Revoked TravisCI access to GitHub"></p><h1 id=add-a-github-action-workflow-to-your-project>Add a GitHub Action workflow to your project
<a class=heading-link href=#add-a-github-action-workflow-to-your-project><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>The next step is to create a new GitHub Action workflow that will build your Hugo site and deploy it to the server of your choice using <a href=https://linux.die.net/man/1/rsync>rsync</a>. Navigate to the Actions tab in your GitHub repository and select the &ldquo;Skip this and set up a workflow yourself&rdquo; option to directly access the workflow editor. Workflows <a href=https://docs.github.com/en/actions/reference/workflow-syntax-for-github-actions>use YAML syntax</a> and are saved within the <code>.github/workflows/</code> directory in your repository.</p><p><strong>The current workflow for building and deploying this website can be seen <a href=https://github.com/shiruken/csullender.com/blob/master/.github/workflows/build.yml><strong>here</strong></a> if you want to skip the explanation below.</strong></p><p>The first section of the file defines the name and the GitHub events that trigger the workflow. We want the workflow to be triggered when code is pushed to any branch in the repository (<code>push</code>) or manually triggered by the owner (<code>workflow_dispatch</code>).</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#268bd2>name</span>: Build Site
</span></span><span style=display:flex><span><span style=color:#268bd2>on</span>:
</span></span><span style=display:flex><span>  <span style=color:#268bd2>push</span>: 
</span></span><span style=display:flex><span>  <span style=color:#268bd2>workflow_dispatch</span>: </span></span></code></pre></div><p>The next section defines the <a href=https://docs.github.com/en/actions/reference/workflow-syntax-for-github-actions#jobs>job(s)</a> that constitute the workflow. In this case, there is only a single job called <code>build</code> that runs on the latest version of Ubuntu. Jobs are composed of individual <a href=https://docs.github.com/en/actions/reference/workflow-syntax-for-github-actions#jobsjob_idsteps>steps</a> that are executed sequentially. These steps are frequently predefined GitHub Actions available via the <a href="https://github.com/marketplace?type=actions">Marketplace</a>.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#268bd2>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#268bd2>build</span>:
</span></span><span style=display:flex><span>    <span style=color:#268bd2>name</span>: Build Hugo Site
</span></span><span style=display:flex><span>    <span style=color:#268bd2>runs-on</span>: ubuntu-latest
</span></span><span style=display:flex><span>    <span style=color:#268bd2>steps</span>: </span></span></code></pre></div><p>The first step uses the <a href=https://github.com/marketplace/actions/checkout><code>checkout</code></a> action to check-out the current repository into our workspace. Since our Hugo theme (<a href=https://github.com/luizdepra/hugo-coder>hugo-coder</a>) is included in the project as a submodule, we need to include the <code>submodules: true</code> input parameter to properly check it out.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#268bd2>name</span>: Checkout Repository
</span></span><span style=display:flex><span>  <span style=color:#268bd2>uses</span>: actions/checkout@v2
</span></span><span style=display:flex><span>  <span style=color:#268bd2>with</span>:
</span></span><span style=display:flex><span>    <span style=color:#268bd2>submodules</span>: <span style=color:#cb4b16>true</span></span></span></code></pre></div><p>The next step uses the <a href=https://github.com/marketplace/actions/hugo-setup><code>actions-hugo</code></a> action to install Hugo to our workspace. The input parameters control the specific version of Hugo to install. The <a href=https://github.com/luizdepra/hugo-coder>hugo-coder theme</a> requires the extended version of Hugo.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#268bd2>name</span>: Setup Hugo
</span></span><span style=display:flex><span>  <span style=color:#268bd2>uses</span>: peaceiris/actions-hugo@v2
</span></span><span style=display:flex><span>  <span style=color:#268bd2>with</span>:
</span></span><span style=display:flex><span>    <span style=color:#268bd2>hugo-version</span>: <span style=color:#2aa198>&#39;latest&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#268bd2>extended</span>: <span style=color:#cb4b16>true</span></span></span></code></pre></div><p>With Hugo installed, we can now build our site using the <a href=https://docs.github.com/en/actions/reference/workflow-syntax-for-github-actions#jobsjob_idstepsrun><code>run</code> command</a> to call the <code>hugo</code> program via the command line. This will output the compiled static site into the <code>public/</code> directory.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#268bd2>name</span>: Build
</span></span><span style=display:flex><span>  <span style=color:#268bd2>run</span>: hugo</span></span></code></pre></div><p>We&rsquo;re now ready to deploy our freshly built site to the remote server. However, we only want to deploy if we&rsquo;re on the primary branch, so the final step checks for this condition before proceeding. If we&rsquo;re on a non-primary branch, then the workflow will end here.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#268bd2>name</span>: Deploy
</span></span><span style=display:flex><span>  <span style=color:#268bd2>if</span>: github.ref == &#39;refs/heads/master&#39;</span></span></code></pre></div><p>In order to deploy to the remote server using rsync, we need to take advantage of encrypted <a href=https://docs.github.com/en/actions/reference/encrypted-secrets>Repository Secrets</a> to safely store our credentials. You can define these secrets under the settings for your GitHub repository. I opted to use an <a href=https://docs.github.com/en/github/authenticating-to-github/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent#generating-a-new-ssh-key>SSH key pair</a> to authenticate with the remote server (storing the private key under <code>DEPLOY_KEY</code> and adding the public key to <code>.ssh/authorized_keys</code> on the remote) but a password could also be stored this way. I also defined several other additional secrets to mask the username, hostname, and destination on the remote host. Secrets can be accessed in the workflow file using the <code>{{secrets.SECRETNAME}}</code> syntax. <em>Note: GitHub automatically obfuscates any secrets that are accidentally exposed in the logs via command line outputs.</em></p><p><img src=secrets.png alt="Encrypted Repository Secrets"></p><p>We again use the <code>run</code> command to dump the private key to a file in the workspace, adjust the permissions on the key file, and then use <code>rsync</code> to sync the contents of <code>public/</code> to the remote destination. If all goes well, then your updated site should now be live on your server.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#268bd2>env</span>:
</span></span><span style=display:flex><span>  <span style=color:#268bd2>DEPLOY_KEY</span>: ${{secrets.DEPLOY_KEY}}
</span></span><span style=display:flex><span>  <span style=color:#268bd2>DEST</span>: ${{secrets.DEPLOY_USER}}@${{secrets.DEPLOY_HOST}}:${{secrets.DEPLOY_DIRECTORY}}
</span></span><span style=display:flex><span><span style=color:#268bd2>run</span>: |<span style=color:#2aa198>
</span></span></span><span style=display:flex><span><span style=color:#2aa198>  echo &#34;$DEPLOY_KEY&#34; &gt; deploy_key
</span></span></span><span style=display:flex><span><span style=color:#2aa198>  chmod 600 ./deploy_key
</span></span></span><span style=display:flex><span><span style=color:#2aa198>  rsync -e &#39;ssh -i ./deploy_key -o StrictHostKeyChecking=no -o LogLevel=ERROR&#39; -r --quiet --delete-after public/* $DEST</span>  </span></span></code></pre></div><h1 id=test-your-new-github-action-workflow>Test your new GitHub Action workflow
<a class=heading-link href=#test-your-new-github-action-workflow><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>Since we enabled manual triggering of the workflow, we can now easily test it. Navigate to the Actions tab in your repository and select the workflow from the list on the left. Click the &ldquo;Run workflow&rdquo; dropdown, select a branch, and then click the green &ldquo;Run workflow&rdquo; button. Your workflow should now be manually executing.</p><p><img src=running.png alt="Running GitHub Actions Workflow"></p><p>If you click through, you can see additional details about the run including the outputs from each stage of the workflow. If you ran the workflow on any branch but the primary one, then the &ldquo;Deploy&rdquo; step should have been skipped.</p><p><img src=output.png alt="GitHub Actions Run Summary"></p><p>You should now have a fully functional CI/CD setup using GitHub Actions to replace the shuttered Open Source TravisCI service! Hopefully GitHub (more likely Microsoft) doesn&rsquo;t start changing the free offerings on their platform anytime soon. Don&rsquo;t forget to re-add the status badge back to your README file!</p><p><img src="https://github.com/shiruken/csullender.com/workflows/Build%20Site/badge.svg?branch=master" alt="Build Site"></p></div><footer><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//csullender.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></footer></article></section></div><footer class=footer><section class=container>©
2022
Colin Sullender
·
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.
[<a href=https://github.com/shiruken/csullender.com/commit/86249c0c54e44524abb387d44cb8b3ce3475bc39>86249c0</a>]</section></footer></main><script src=/js/coder.min.236049395dc3682fb2719640872958e12f1f24067bb09c327b233e6290c7edac.js integrity="sha256-I2BJOV3DaC+ycZZAhylY4S8fJAZ7sJwyeyM+YpDH7aw="></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XKMRF7KB73"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XKMRF7KB73",{anonymize_ip:!1})}</script><script async defer data-domain=csullender.com src=https://p.csullender.com/js/plausible.js></script>
<script>var _paq=window._paq=window._paq||[];_paq.push(["setCookieDomain","*.csullender.com"]),_paq.push(["setDomains",["*.csullender.com"]]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){e="https://m.csullender.com/",_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","1"]);var e,n=document,t=n.createElement("script"),s=n.getElementsByTagName("script")[0];t.async=!0,t.src=e+"matomo.js",s.parentNode.insertBefore(t,s)}()</script><noscript><p><img src="https://m.csullender.com/matomo.php?idsite=1&rec=1" style=border:0 alt></p></noscript></body></html>